#include "fir.h"

#include <cstdio>
#include <cstring>

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
Fir::Fir (float* h, int n) {

      c_ = 0;
      n_ = n;
      order_ = n - 1;

      h_ = new float[n_];
      d_ = new float[n_];

      int i;
      for (i = 0; i < n_; i++) {
	    d_[i] = 0.0F;
      }
      for (i = 0; i < n_; i++) {
	    h_[i] = h[i];
      }
      
}
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
Fir::~Fir() {
      delete[] d_;
      delete[] h_;
}


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void Fir::Filter(float* x, float* y, int sz) {
      int i;
      int j;
      int k;
      float a;

      for (i = 0; i < sz; i++) {
	    // Pongo la muestra actual x[i] en la linea de retardos (bufer circular)
	    c_--;
	    if (c_ == -1) {
		  c_ = n_ - 1;
	    }

	    d_[c_] = x[i];

	    a = 0.0F;
	    k = c_;
	    for (j = 0; j < n_; j++) {
		  //printf("d_[%d]=%f * h_[%d] = %f\n", k, d_[k], j, h_[j]);
		  a += d_[k] * h_[j];

		  k++;
		  if (k == n_) {
			k = 0;
		  }
	    } 
	    
	    y[i] = a;
      }
}
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

